# escape=`
FROM microsoft/aspnet
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop';"]

RUN `
    # Disable DNS cache.
    Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\Dnscache\Parameters' -Name ServerPriorityTimeLimit -Value 0 -Type DWord; `
    # Install Chocolatey.
    $env:chocolateyUseWindowsCompression = 'false'; `
    iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex; `
    # Install WebDeploy, Psake.
    choco install webdeploy psake -y

COPY scripts C:\Temp\scripts
COPY default.ps1 C:\Temp\default.ps1

COPY BoringWarehouse.zip C:\Temp\BoringWarehouse.zip

ENV SemVer=0.0.0 `
    MajorMinorPatch=0.0.0

WORKDIR C:\Temp
RUN ["psake.bat", "publish-boringwarehouse", "-properties", "@{ServerHost='localhost';SiteName='Default Web Site'}"]

EXPOSE 80
